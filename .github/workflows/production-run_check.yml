name: production run check

on:
  push:
    branches: [$default-branch]
  pull_request:
    types: [assigned, opened, synchronize, reopened]

jobs:
  build:
    runs-on: ubuntu-20.04
    steps:
      - name: Check out Github repository
        uses: actions/checkout@v2
      - name: Run
        run: make prod && make prod-down
        env:
          POSTGRES_USER: ${{ secrets.POSTGRES_USER }}
          POSTGRES_PASSWORD: ${{ secrets.POSTGRES_PASSWORD }}
          FORTYTWO_APP_ID: ${{ secrets.FORTYTWO_APP_ID }}
          FORTYTWO_APP_SECRET: ${{ secrets.FORTYTWO_APP_SECRET }}
          SESSION_SECRET: ${{ secrets.SESSION_SECRET }}
          MEMCACHED_SECRET: ${{ secrets.MEMCACHED_SECRET }}
